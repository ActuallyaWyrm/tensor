steps:

# Install common dependencies.
- name: 'gcr.io/learnjs-174218/release'
  id: 'yarn-common'
  entrypoint: 'yarn'
  args: ['install']

# Install coco-ssd dependencies.
# For some reason, yarn fails with ENOENT when looking for jasmine if this is
# not done
- name: 'gcr.io/learnjs-174218/release'
  dir: 'coco-ssd'
  id: 'yarn-coco-ssd'
  entrypoint: 'yarn'
  args: ['install']

# Install task API dependencies.
- name: 'gcr.io/learnjs-174218/release'
  dir: 'tasks'
  entrypoint: 'yarn'
  id: 'yarn'
  args: ['install']
  waitFor: ['yarn-common', 'yarn-coco-ssd']

# Lint.
- name: 'gcr.io/learnjs-174218/release'
  dir: 'tasks'
  entrypoint: 'yarn'
  id: 'lint'
  args: ['lint']
  waitFor: ['yarn']

# Build deps.
- name: 'gcr.io/learnjs-174218/release'
  dir: 'tasks'
  entrypoint: 'yarn'
  id: 'build-deps'
  args: ['build-deps']
  waitFor: ['yarn']

# Build.
- name: 'gcr.io/learnjs-174218/release'
  dir: 'tasks'
  entrypoint: 'yarn'
  id: 'build'
  args: ['build']
  waitFor: ['yarn', 'build-deps']

# Run tests.
- name: 'gcr.io/learnjs-174218/release'
  dir: 'tasks'
  entrypoint: 'yarn'
  id: 'test'
  args: ['test']
  waitFor: ['yarn', 'build-deps']

# General configuration
timeout: 1800s
logsBucket: 'gs://tfjs-build-logs'
substitutions:
  _NIGHTLY: ''
options:
  logStreamingOption: 'STREAM_ON'
  substitution_option: 'ALLOW_LOOSE'
